# Использование командной строки gac

[English](../en/USAGE.md) | [简体中文](../zh-CN/USAGE.md) | [繁體中文](../zh-TW/USAGE.md) | [日本語](../ja/USAGE.md) | [한국어](../ko/USAGE.md) | [हिन्दी](../hi/USAGE.md) | [Tiếng Việt](../vi/USAGE.md) | [Français](../fr/USAGE.md) | **Русский** | [Español](../es/USAGE.md) | [Português](../pt/USAGE.md) | [Norsk](../no/USAGE.md) | [Svenska](../sv/USAGE.md) | [Deutsch](../de/USAGE.md) | [Nederlands](../nl/USAGE.md) | [Italiano](../it/USAGE.md)

Этот документ описывает все доступные флаги и опции для CLI-инструмента `gac`.

## Содержание

- [Использование командной строки gac](#использование-командной-строки-gac)
  - [Содержание](#содержание)
  - [Базовое использование](#базовое-использование)
  - [Флаги основного рабочего процесса](#флаги-основного-рабочего-процесса)
  - [Настройка сообщений](#настройка-сообщений)
  - [Вывод и детализация](#вывод-и-детализация)
  - [Справка и версия](#справка-и-версия)
  - [Примеры рабочих процессов](#примеры-рабочих-процессов)
  - [Расширенные возможности](#расширенные-возможности)
    - [Интеграция со скриптами и внешняя обработка](#интеграция-со-скриптами-и-внешняя-обработка)
    - [Пропуск хуков pre-commit и lefthook](#пропуск-хуков-pre-commit-и-lefthook)
    - [Сканирование безопасности](#сканирование-безопасности)
    - [Проверка SSL-сертификата](#проверка-ssl-сертификата)
  - [Замечания по конфигурации](#замечания-по-конфигурации)
    - [Расширенные опции конфигурации](#расширенные-опции-конфигурации)
    - [Подкоманды конфигурации](#подкоманды-конфигурации)
  - [Интерактивный режим](#интерактивный-режим)
    - [Как это работает](#как-это-работает)
    - [Когда использовать интерактивный режим](#когда-использовать-интерактивный-режим)
    - [Примеры использования](#примеры-использования)
    - [Рабочий процесс вопросов и ответов](#рабочий-процесс-вопросов-и-ответов)
    - [Комбинация с другими флагами](#комбинация-с-другими-флагами)
    - [Лучшие практики](#лучшие-практики)
  - [Получение справки](#получение-справки)

## Базовое использование

```sh
gac init
# Затем следуйте подсказкам для настройки вашего поставщика, модели и API-ключей в интерактивном режиме
gac
```

Генерирует сообщение коммита на основе LLM для индексированных изменений и запрашивает подтверждение. Подтверждение принимает:

- `y` или `yes` - Продолжить коммит
- `n` или `no` - Отменить коммит
- `r` или `reroll` - Пересгенерировать сообщение коммита с тем же контекстом
- `e` или `edit` - Редактировать сообщение коммита на месте с богатым редактированием в терминале (горячие клавиши vi/emacs)
- Любой другой текст - Пересгенерировать с этим текстом в качестве обратной связи (например, `сделай короче`, `сфокусируйся на производительности`)
- Пустой ввод (только Enter) - Показать подсказку снова

---

## Флаги основного рабочего процесса

| Флаг / Опция         | Короткий | Описание                                                                              |
| -------------------- | -------- | ------------------------------------------------------------------------------------- |
| `--add-all`          | `-a`     | Индексировать все изменения перед коммитом                                            |
| `--group`            | `-g`     | Группировать индексированные изменения в несколько логических коммитов                |
| `--push`             | `-p`     | Отправить изменения в удалённый репозиторий после коммита                             |
| `--yes`              | `-y`     | Автоматически подтверждать коммит без запроса                                         |
| `--dry-run`          |          | Показать, что произойдёт, не внося никаких изменений                                  |
| `--message-only`     |          | Вывести только сгенерированное сообщение коммита без фактического выполнения коммита  |
| `--no-verify`        |          | Пропускать хуки pre-commit и lefthook при коммите                                     |
| `--skip-secret-scan` |          | Пропускать сканирование безопасности на наличие секретов в индексированных изменениях |
| `--no-verify-ssl`    |          | Пропускать проверку SSL-сертификата (полезно для корпоративных прокси)                |
| `--interactive`      | `-i`     | Задавать вопросы об изменениях для лучших коммитов                                    |

**Примечание:** Комбинируйте `-a` и `-g` (то есть `-ag`) для индексации ВСЕХ изменений, затем группировки их в коммиты.

**Примечание:** При использовании `--group` лимит максимальных выходных токенов автоматически масштабируется в зависимости от количества фиксируемых файлов (2x для 1-9 файлов, 3x для 10-19 файлов, 4x для 20-29 файлов, 5x для 30+ файлов). Это гарантирует, что у LLM достаточно токенов для генерации всех сгруппированных коммитов без усечения, даже для больших наборов изменений.

**Примечание:** `--message-only` и `--group` являются взаимоисключающими. Используйте `--message-only`, когда вам нужно получить сообщение коммита для внешней обработки, и `--group`, когда вы хотите организовать несколько коммитов в рамках текущего git‑рабочего процесса.

**Примечание:** Флаг `--interactive` предоставляет дополнительный контекст LLM, задавая вопросы о ваших изменениях, что приводит к более точным и детальным сообщениям коммитов. Это особенно полезно для сложных изменений или когда вы хотите убедиться, что сообщение коммита полностью отражает контекст вашей работы.

## Настройка сообщений

| Флаг / Опция        | Короткий | Описание                                                                       |
| ------------------- | -------- | ------------------------------------------------------------------------------ |
| `--one-liner`       | `-o`     | Генерировать однострочное сообщение коммита                                    |
| `--verbose`         | `-v`     | Генерировать подробные сообщения коммита с мотивацией, архитектурой и влиянием |
| `--hint <text>`     | `-h`     | Добавить подсказку для направления LLM                                         |
| `--model <model>`   | `-m`     | Указать модель для использования в этом коммите                                |
| `--language <lang>` | `-l`     | Переопределить язык (название или код: 'Spanish', 'es', 'zh-CN', 'ja')         |
| `--scope`           | `-s`     | Выводить соответствующую область для коммита                                   |

**Примечание:** Вы можете предоставлять обратную связь интерактивно, просто вводя её в подсказке подтверждения - нет необходимости добавлять префикс 'r'. Введите `r` для простого пересоздания, `e` для редактирования на месте с горячими клавишами vi/emacs, или введите свою обратную связь напрямую, например `сделай короче`.

## Вывод и детализация

| Флаг / Опция          | Короткий | Описание                                                             |
| --------------------- | -------- | -------------------------------------------------------------------- |
| `--quiet`             | `-q`     | Подавить весь вывод, кроме ошибок                                    |
| `--log-level <level>` |          | Установить уровень логирования (debug, info, warning, error)         |
| `--show-prompt`       |          | Показать LLM-подсказку, используемую для генерации сообщения коммита |

## Справка и версия

| Флаг / Опция | Короткий | Описание                              |
| ------------ | -------- | ------------------------------------- |
| `--version`  |          | Показать версию gac и выйти           |
| `--help`     |          | Показать справочное сообщение и выйти |

---

## Примеры рабочих процессов

- **Индексировать все изменения и закоммитить:**

  ```sh
  gac -a
  ```

- **Закоммитить и отправить за один шаг:**

  ```sh
  gac -ap
  ```

- **Сгенерировать однострочное сообщение коммита:**

  ```sh
  gac -o
  ```

- **Сгенерировать подробное сообщение коммита со структурированными разделами:**

  ```sh
  gac -v
  ```

- **Добавить подсказку для LLM:**

  ```sh
  gac -h "Рефакторинг логики аутентификации"
  ```

- **Вывести область для коммита:**

  ```sh
  gac -s
  ```

- **Группировать индексированные изменения в логические коммиты:**

  ```sh
  gac -g
  # Группирует только файлы, которые вы уже проиндексировали
  ```

- **Группировать все изменения (индексированные + неиндексированные) и автоматически подтвердить:**

  ```sh
  gac -agy
  # Индексирует всё, группирует и автоматически подтверждает
  ```

- **Использовать конкретную модель только для этого коммита:**

  ```sh
  gac -m anthropic:claude-haiku-4-5
  ```

- **Сгенерировать сообщение коммита на конкретном языке:**

  ```sh
  # Используя языковые коды (короче)
  gac -l zh-CN
  gac -l ja
  gac -l es

  # Используя полные названия
  gac -l "Simplified Chinese"
  gac -l Japanese
  gac -l Spanish
  ```

- **Тестовый запуск (увидеть, что произойдёт):**

  ```sh
  gac --dry-run
  ```

- **Получить только сообщение коммита (для интеграции со скриптами):**

  ```sh
  gac --message-only
  # Пример вывода: feat: add user authentication system
  ```

- **Получить сообщение коммита в однострочном формате:**

  ```sh
  gac --message-only --one-liner
  # Пример вывода: feat: add user authentication system
  ```

- **Использовать интерактивный режим для предоставления контекста:**

  ```sh
  gac -i
  # Какова основная цель этих изменений?
  # Какую проблему вы решаете?
  # Есть ли детали реализации, которые стоит упомянуть?
  ```

- **Интерактивный режим с детальным выводом:**

  ```sh
  gac -i -v
  # Задавать вопросы и генерировать детальные сообщения коммитов
  ```

## Расширенные возможности

- Комбинируйте флаги для более мощных рабочих процессов (например, `gac -ayp` для индексации, автоматического подтверждения и отправки)
- Используйте `--show-prompt` для отладки или просмотра подсказки, отправленной в LLM
- Настраивайте детализацию с помощью `--log-level` или `--quiet`
- Используйте `--message-only` для интеграции со скриптами и автоматизированных рабочих процессов

### Интеграция со скриптами и внешняя обработка

Флаг `--message-only` разработан для интеграции со скриптами и рабочих процессов с внешними инструментами. Он выводит только исходное сообщение коммита без какого-либо форматирования, индикаторов загрузки или дополнительных элементов интерфейса.

**Варианты использования:**

- **Интеграция с AI-агентами:** Позволяет AI-агентам получать сообщения коммитов и обрабатывать коммиты самостоятельно
- **Альтернативные VCS:** Использование сгенерированных сообщений с другими системами контроля версий (Mercurial, Jujutsu и т.д.)
- **Пользовательские рабочие процессы коммитов:** Обработка или изменение сообщения перед коммитом
- **CI/CD конвейеры:** Извлечение сообщений коммитов для автоматизированных процессов

**Пример использования в скриптах:**

```sh
#!/bin/bash
# Получение сообщения коммита и использование с пользовательской функцией коммита
MESSAGE=$(gac --message-only --add-all --yes)
git commit -m "$MESSAGE"
```

```python
# Пример интеграции с Python
import subprocess

def get_commit_message():
    result = subprocess.run(
        ["gac", "--message-only", "--yes"],
        capture_output=True, text=True
    )
    return result.stdout.strip()

message = get_commit_message()
print(f"Сгенерированное сообщение: {message}")
```

**Ключевые возможности для использования в скриптах:**

- Чистый вывод без форматирования Rich или индикаторов загрузки
- Автоматический обход запросов подтверждения
- Фактический коммит в git не выполняется
- Работает с `--one-liner` для упрощенного вывода
- Может комбинироваться с другими флагами, такими как `--hint`, `--model` и т.д.

### Пропуск хуков pre-commit и lefthook

Флаг `--no-verify` позволяет вам пропустить любые хуки pre-commit или lefthook, настроенные в вашем проекте:

```sh
gac --no-verify  # Пропустить все хуки pre-commit и lefthook
```

**Используйте `--no-verify`, когда:**

- Хуки pre-commit или lefthook временно не работают
- Работа с трудоёмкими хуками
- Коммит кода в разработке, который ещё не проходит все проверки

**Примечание:** Используйте с осторожностью, так как эти хуки поддерживают стандарты качества кода.

### Сканирование безопасности

gac включает встроенное сканирование безопасности, которое автоматически обнаруживает потенциальные секреты и API-ключи в ваших индексированных изменениях перед коммитом. Это помогает предотвратить случайный коммит конфиденциальной информации.

**Пропуск сканирования безопасности:**

```sh
gac --skip-secret-scan  # Пропустить сканирование безопасности для этого коммита
```

**Для отключения навсегда:** Установите `GAC_SKIP_SECRET_SCAN=true` в вашем файле `.gac.env`.

**Когда пропускать:**

- Коммит примеров кода с заглушками для ключей
- Работа с тестовыми фикстурами, содержащими фиктивные учётные данные
- Когда вы проверили, что изменения безопасны

**Примечание:** Сканер использует сопоставление шаблонов для обнаружения распространённых форматов секретов. Всегда просматривайте ваши индексированные изменения перед коммитом.

### Проверка SSL-сертификата

Флаг `--no-verify-ssl` позволяет пропустить проверку SSL-сертификата для API-запросов:

```sh
gac --no-verify-ssl  # Пропустить проверку SSL для этого коммита
```

**Для постоянной настройки:** Установите `GAC_NO_VERIFY_SSL=true` в вашем файле `.gac.env`.

**Используйте `--no-verify-ssl`, когда:**

- Корпоративные прокси перехватывают SSL-трафик (MITM-прокси)
- Среда разработки использует самоподписанные сертификаты
- Возникают ошибки SSL-сертификата из-за настроек сетевой безопасности

**Примечание:** Используйте эту опцию только в доверенных сетевых средах. Отключение проверки SSL снижает безопасность и может сделать ваши API-запросы уязвимыми для атак «человек посередине».

## Замечания по конфигурации

- Рекомендуемый способ настройки gac - запустить `gac init` и следовать интерактивным подсказкам.
- Уже настроили язык и нужно просто переключить поставщиков или модели? Запустите `gac model` для повторной настройки без вопросов о языке.
- **Используете Claude Code?** См. [руководство по настройке Claude Code](CLAUDE_CODE.md) для инструкций по OAuth-аутентификации.
- **Используете Qwen.ai?** Смотрите [руководство по настройке Qwen.ai](QWEN.md) для инструкций аутентификации OAuth.
- gac загружает конфигурацию в следующем порядке приоритета:
  1. Флаги CLI
  2. Переменные окружения
  3. Уровень проекта `.gac.env`
  4. Уровень пользователя `~/.gac.env`

### Расширенные опции конфигурации

Вы можете настроить поведение gac с помощью этих дополнительных переменных окружения:

- `GAC_ALWAYS_INCLUDE_SCOPE=true` - Автоматически выводить и включать область в сообщения коммитов (например, `feat(auth):` вместо `feat:`)
- `GAC_VERBOSE=true` - Генерировать подробные сообщения коммита с разделами мотивации, архитектуры и влияния
- `GAC_TEMPERATURE=0.7` - Управлять творческостью LLM (0.0-1.0, ниже = более сфокусированно)
- `GAC_MAX_OUTPUT_TOKENS=4096` - Максимальное количество токенов для сгенерированных сообщений (автоматически масштабируется 2-5x при использовании `--group` в зависимости от количества файлов; переопределите для большего или меньшего значения)
- `GAC_WARNING_LIMIT_TOKENS=4096` - Предупреждать, когда подсказки превышают это количество токенов
- `GAC_SYSTEM_PROMPT_PATH=/path/to/custom_prompt.txt` - Использовать пользовательскую системную подсказку для генерации сообщения коммита
- `GAC_LANGUAGE=Spanish` - Генерировать сообщения коммитов на конкретном языке (например, Spanish, French, Japanese, German). Поддерживает полные названия или ISO-коды (es, fr, ja, de, zh-CN). Используйте `gac language` для интерактивного выбора
- `GAC_TRANSLATE_PREFIXES=true` - Переводить префиксы обычных коммитов (feat, fix и т.д.) на целевой язык (по умолчанию: false, сохраняет префиксы на английском)
- `GAC_SKIP_SECRET_SCAN=true` - Отключить автоматическое сканирование безопасности на наличие секретов в индексированных изменениях (используйте с осторожностью)
- `GAC_NO_VERIFY_SSL=true` - Пропускать проверку SSL-сертификата для API-запросов (полезно для корпоративных прокси, которые перехватывают SSL-трафик)
- `GAC_NO_TIKTOKEN=true` - Оставаться полностью офлайн, обходя этап загрузки `tiktoken` и используя встроенный грубый оценщик токенов

Смотрите `.gac.env.example` для полного шаблона конфигурации.

Для подробного руководства по созданию пользовательских системных подсказок смотрите [docs/CUSTOM_SYSTEM_PROMPTS.md](docs/CUSTOM_SYSTEM_PROMPTS.md).

### Подкоманды конфигурации

Доступны следующие подкоманды:

- `gac init` — Интерактивный мастер настройки для поставщика, модели и языковой конфигурации
- `gac model` — Настройка поставщика/модели/API-ключа без подсказок языка (идеально для быстрого переключения)
- `gac auth` — Показать статус OAuth-аутентификации для всех провайдеров
- `gac auth claude-code login` — Войти в Claude Code используя OAuth (открывает браузер)
- `gac auth claude-code logout` — Выйти из Claude Code и удалить сохраненный токен
- `gac auth claude-code status` — Проверить статус аутентификации Claude Code
- `gac auth qwen login` — Войти в Qwen используя OAuth device flow (открывает браузер)
- `gac auth qwen logout` — Выйти из Qwen и удалить сохраненный токен
- `gac auth qwen status` — Проверить статус аутентификации Qwen
- `gac config show` — Показать текущую конфигурацию
- `gac config set KEY VALUE` — Установить ключ конфигурации в `$HOME/.gac.env`
- `gac config get KEY` — Получить значение конфигурации
- `gac config unset KEY` — Удалить ключ конфигурации из `$HOME/.gac.env`
- `gac language` (или `gac lang`) — Интерактивный селектор языка для сообщений коммитов (устанавливает GAC_LANGUAGE)
- `gac diff` — Показать отфильтрованный git diff с опциями для индексированных/неиндексированных изменений, цвета и усечения

## Интерактивный режим

Флаг `--interactive` (`-i`) улучшает генерацию сообщений коммитов gac, задавая целенаправленные вопросы о ваших изменениях. Этот дополнительный контекст помогает LLM создавать более точные, детальные и контекстуально соответствующие сообщения коммитов.

### Как это работает

Когда вы используете `--interactive`, gac задаст вопросы, такие как:

- **Какова основная цель этих изменений?** - Помогает понять высокоуровневую цель
- **Какую проблему вы решаете?** - Предоставляет контекст о мотивации
- **Есть ли детали реализации, которые стоит упомянуть?** - Захватывает технические спецификации
- **Есть ли breaking changes?** - Идентифицирует потенциальные проблемы влияния
- **Это связано с какой-либо issue или тикетом?** - Связывает с управлением проектами

### Когда использовать интерактивный режим

Интерактивный режим особенно полезен для:

- **Сложных изменений**, где контекст не ясен только из diff
- **Работы по рефакторингу**, охватывающей несколько файлов и концепций
- **Новых функций**, требующих объяснения общей цели
- **Исправления ошибок**, где корневая причина не сразу видна
- **Оптимизации производительности**, где логика не очевидна
- **Подготовки к code review** - вопросы помогают вам подумать о своих изменениях

### Примеры использования

**Базовый интерактивный режим:**

```sh
gac -i
```

Это сделает следующее:

1. Покажет сводку индексированных изменений
2. Задаст вопросы об изменениях
3. Сгенерирует сообщение коммита с вашими ответами
4. Попросит подтверждения (или автоматически подтвердит при сочетании с `-y`)

**Интерактивный режим с индексированными изменениями:**

```sh
gac -ai
# Индексировать все изменения, затем задать вопросы для лучшего контекста
```

**Интерактивный режим с конкретными подсказками:**

```sh
gac -i -h "Миграция базы данных для профилей пользователей"
# Задавать вопросы, предоставляя конкретную подсказку для фокусировки LLM
```

**Интерактивный режим с детальным выводом:**

```sh
gac -i -v
# Задавать вопросы и генерировать детальное, структурированное сообщение коммита
```

**Автоматически подтвержденный интерактивный режим:**

```sh
gac -i -y
# Задавать вопросы, но автоматически подтвердить результирующий коммит
```

### Рабочий процесс вопросов и ответов

Интерактивный рабочий процесс следует этому шаблону:

1. **Обзор изменений** - gac показывает сводку того, что вы коммитите
2. **Ответ на вопросы** - отвечайте на каждый запрос с релевантными деталями
3. **Улучшение контекста** - ваши ответы добавляются к LLM-промпту
4. **Генерация сообщения** - LLM создает сообщение коммита с полным контекстом
5. **Подтверждение** - проверьте и подтвердите коммит (или автоматически с `-y`)

**Советы для полезных ответов:**

- **Краткий, но полный** - предоставляйте важные детали, не будучи излишне многословным
- **Фокусируйтесь на "почему"** - объясняйте рассуждения за вашими изменениями
- **Упоминайте ограничения** - отмечайте ограничения или особые соображения
- **Связывайте с внешним контекстом** - ссылайтесь на issues, документацию или документы дизайна
- **Пустые ответы допустимы** - если вопрос не применим, просто нажмите Enter

### Комбинация с другими флагами

Интерактивный режим хорошо работает с большинством других флагов:

```sh
# Индексировать все изменения и задавать вопросы
gac -ai

# Задавать вопросы с детальным выводом
gac -i -v
```

### Лучшие практики

- **Используйте для сложных PR** - особенно полезно для pull requests, требующих детальных объяснений
- **Командная работа** - вопросы помогают вам подумать об изменениях, которые будут проверять другие
- **Подготовка документации** - ваши ответы могут помочь сформировать основу для release notes
- **Инструмент обучения** - вопросы укрепляют хорошие практики сообщений коммитов
- **Пропускайте для простых изменений** - для тривиальных исправлений базовый режим может быть быстрее

## Получение справки

- Для пользовательских системных подсказок смотрите [docs/CUSTOM_SYSTEM_PROMPTS.md](docs/CUSTOM_SYSTEM_PROMPTS.md)
- Для устранения неполадок и расширенных советов смотрите [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md)
- Для установки и конфигурации смотрите [README.md#installation-and-configuration](README.md#installation-and-configuration)
- Для содействия смотрите [docs/CONTRIBUTING.md](docs/CONTRIBUTING.md)
- Информация о лицензии: [LICENSE](LICENSE)
