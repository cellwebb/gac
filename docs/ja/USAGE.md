# gac コマンドライン使用法

[English](../en/USAGE.md) | [简体中文](../zh-CN/USAGE.md) | [繁體中文](../zh-TW/USAGE.md) | **日本語** | [한국어](../ko/USAGE.md) | [हिन्दी](../hi/USAGE.md) | [Tiếng Việt](../vi/USAGE.md) | [Français](../fr/USAGE.md) | [Русский](../ru/USAGE.md) | [Español](../es/USAGE.md) | [Português](../pt/USAGE.md) | [Norsk](../no/USAGE.md) | [Svenska](../sv/USAGE.md) | [Deutsch](../de/USAGE.md) | [Nederlands](../nl/USAGE.md) | [Italiano](../it/USAGE.md)

このドキュメントでは、`gac` CLI ツールで利用可能なすべてのフラグとオプションについて説明します。

## 目次

- [gac コマンドライン使用法](#gac-コマンドライン使用法)
  - [目次](#目次)
  - [基本使用法](#基本使用法)
  - [コアワークフローフラグ](#コアワークフローフラグ)
  - [メッセージカスタマイズ](#メッセージカスタマイズ)
  - [出力と詳細レベル](#出力と詳細レベル)
  - [ヘルプとバージョン](#ヘルプとバージョン)
  - [ワークフロー例](#ワークフロー例)
  - [詳細](#詳細)
    - [スクリプト統合と外部処理](#スクリプト統合と外部処理)
    - [Pre-commit と Lefthook フックのスキップ](#pre-commit-と-lefthook-フックのスキップ)
    - [セキュリティスキャン](#セキュリティスキャン)
    - [SSL証明書検証](#ssl証明書検証)
  - [設定に関する注意](#設定に関する注意)
    - [高度な設定オプション](#高度な設定オプション)
    - [設定サブコマンド](#設定サブコマンド)
  - [インタラクティブモード](#インタラクティブモード)
    - [動作方法](#動作方法)
    - [インタラクティブモードを使用する場合](#インタラクティブモードを使用する場合)
    - [使用例](#使用例)
    - [質疑応答ワークフロー](#質疑応答ワークフロー)
    - [他のフラグとの組み合わせ](#他のフラグとの組み合わせ)
    - [ベストプラクティス](#ベストプラクティス)
  - [ヘルプ](#ヘルプ)

## 基本使用法

```sh
gac init
# 次にプロンプトに従ってプロバイダー、モデル、APIキーを対話的に設定
gac
```

ステージされた変更に対して LLM を活用したコミットメッセージを生成し、確認を求めます。確認プロンプトでは以下が受け付けられます：

- `y` または `yes` - コミットを続行
- `n` または `no` - コミットをキャンセル
- `r` または `reroll` - 同じコンテキストでコミットメッセージを再生成
- `e` または `edit` - リッチなターミナル編集でコミットメッセージをその場編集（vi/emacs キーバインド）
- その他のテキスト - そのテキストをフィードバックとして再生成（例: `もっと短くして`、`パフォーマンスに集中`）
- 空入力（Enter のみ） - プロンプトを再表示

---

## コアワークフローフラグ

| フラグ / オプション  | 短い形式 | 説明                                                             |
| -------------------- | -------- | ---------------------------------------------------------------- |
| `--add-all`          | `-a`     | コミット前にすべての変更をステージ                               |
| `--group`            | `-g`     | ステージされた変更を複数の論理的なコミットにグループ化           |
| `--push`             | `-p`     | コミット後にリモートにプッシュ                                   |
| `--yes`              | `-y`     | プロンプトなしで自動的にコミットを確定                           |
| `--dry-run`          |          | 変更なしで何が起こるかを表示                                     |
| `--message-only`     |          | 実際のコミットを行わずに、生成されたコミットメッセージのみを出力 |
| `--no-verify`        |          | コミット時に pre-commit と lefthook フックをスキップ             |
| `--skip-secret-scan` |          | ステージされた変更での秘密検出をスキップ                         |
| `--no-verify-ssl`    |          | SSL証明書の検証をスキップ（企業プロキシに便利）                  |
| `--interactive`      | `-i`     | より良いコミットのために変更について質問する                     |

**注意:** `-ag` のように `-a` と `-g` を組み合わせて、まずすべての変更をステージしてからコミットにグループ化します。

**注意:** `--group` を使用する場合、最大出力トークン制限はコミットされるファイル数に基づいて自動的にスケーリングされます（ファイル数 1-9 で 2 倍、10-19 で 3 倍、20-29 で 4 倍、30 以上で 5 倍）。これにより、LLM が大きな変更セットでもトランケーションなしですべてのグループ化されたコミットを生成するのに十分なトークンを確保できます。

**注意:** `--message-only` と `--group` は同時に使用できません。`--message-only` は外部処理向けにコミットメッセージだけを取得したい場合に、`--group` は現在の git ワークフロー内で複数のコミットを整理したい場合に使用してください。

**注意:** `--interactive` フラグは変更について質問することで LLM に追加のコンテキストを提供し、より正確で詳細なコミットメッセージを生成します。これは複雑な変更の場合や、コミットメッセージが作業の完全なコンテキストを確実に捉えるようにしたい場合に特に便利です。

## メッセージカスタマイズ

| フラグ / オプション | 短い形式 | 説明                                                             |
| ------------------- | -------- | ---------------------------------------------------------------- |
| `--one-liner`       | `-o`     | 単一行のコミットメッセージを生成                                 |
| `--verbose`         | `-v`     | 動機、アーキテクチャ、影響を含む詳細なコミットメッセージを生成   |
| `--hint <text>`     | `-h`     | LLM を導くヒントを追加                                           |
| `--model <model>`   | `-m`     | このコミットで使用するモデルを指定                               |
| `--language <lang>` | `-l`     | 言語を上書き（名前またはコード: 'Spanish', 'es', 'zh-CN', 'ja'） |
| `--scope`           | `-s`     | コミットの適切なスコープを推論                                   |

**注意:** 確認プロンプトで直接フィードバックを入力することで対話的にフィードバックを提供できます - 'r' を前置する必要はありません。シンプルな再生成には `r`、vi/emacs キーバインドでその場編集には `e`、または直接フィードバックを入力（例: `もっと短くして`）。

## 出力と詳細レベル

| フラグ / オプション   | 短い形式 | 説明                                                    |
| --------------------- | -------- | ------------------------------------------------------- |
| `--quiet`             | `-q`     | エラー以外のすべての出力を抑制                          |
| `--log-level <level>` |          | ログレベルを設定（debug, info, warning, error）         |
| `--show-prompt`       |          | コミットメッセージ生成に使用される LLM プロンプトを表示 |

## ヘルプとバージョン

| フラグ / オプション | 短い形式 | 説明                           |
| ------------------- | -------- | ------------------------------ |
| `--version`         |          | gac バージョンを表示して終了   |
| `--help`            |          | ヘルプメッセージを表示して終了 |

---

## ワークフロー例

- **すべての変更をステージしてコミット:**

  ```sh
  gac -a
  ```

- **ワンステップでコミットしてプッシュ:**

  ```sh
  gac -ap
  ```

- **単一行コミットメッセージを生成:**

  ```sh
  gac -o
  ```

- **構造化セクション付きの詳細なコミットメッセージを生成:**

  ```sh
  gac -v
  ```

- **LLM にヒントを追加:**

  ```sh
  gac -h "認証ロジックをリファクタリング"
  ```

- **コミットのスコープを推論:**

  ```sh
  gac -s
  ```

- **ステージされた変更を論理的なコミットにグループ化:**

  ```sh
  gac -g
  # すでにステージしたファイルのみをグループ化
  ```

- **すべての変更（ステージ＋未ステージ）をグループ化して自動確定:**

  ```sh
  gac -agy
  # すべてをステージ、グループ化、自動確定
  ```

- **このコミットのみ特定のモデルを使用:**

  ```sh
  gac -m anthropic:claude-haiku-4-5
  ```

- **特定の言語でコミットメッセージを生成:**

  ```sh
  # 言語コードを使用（短い）
  gac -l zh-CN
  gac -l ja
  gac -l es

  # 完全な名前を使用
  gac -l "Simplified Chinese"
  gac -l Japanese
  gac -l Spanish
  ```

- **ドライラン（何が起こるかを確認）:**

  ```sh
  gac --dry-run
  ```

- **コミットメッセージのみを取得（スクリプト統合用）:**

  ```sh
  gac --message-only
  # 出力例: feat: add user authentication system
  ```

- **1 行形式のコミットメッセージを取得:**

  ```sh
  gac --message-only --one-liner
  # 出力例: feat: add user authentication system
  ```

- **コンテキストを提供するためにインタラクティブモードを使用:**

  ```sh
  gac -i
  # これらの変更の主な目的は何ですか？
  # どの問題を解決していますか？
  ```

## 言及する価値のある実装詳細はありますか？

- **詳細出力でインタラクティブモード:**

```sh
gac -i -v
# 質問して詳細なコミットメッセージを生成
```

## 詳細

- より強力なワークフローのためにフラグを組み合わせる（例: `gac -ayp` でステージ、自動確定、プッシュ）
- `--show-prompt` を使用して LLM に送信されるプロンプトをデバッグ・確認
- `--log-level` または `--quiet` で詳細レベルを調整
- `--message-only` をスクリプト統合や自動化されたワークフローに使用

### スクリプト統合と外部処理

`--message-only` フラグは、スクリプト統合や外部ツールのワークフロー向けに設計されています。追加のフォーマットやスピナー、UI 要素なしで、生のコミットメッセージのみを出力します。

**ユースケース:**

- **エージェント統合:** AI エージェントがコミットメッセージを取得し、自身でコミット処理を行えるようにする
- **別の VCS:** 生成されたメッセージを他のバージョン管理システム（Mercurial、Jujutsu など）で使用
- **カスタムコミットワークフロー:** コミット前にメッセージを処理・変更する
- **CI/CD パイプライン:** コミットメッセージを自動処理のために抽出する

**スクリプトでの使用例:**

```sh
#!/bin/bash
# コミットメッセージを取得し、カスタムコミット関数で使用
MESSAGE=$(gac --message-only --add-all --yes)
git commit -m "$MESSAGE"
```

```python
# Python 統合例
import subprocess


def get_commit_message() -> str:
    result = subprocess.run(
        ["gac", "--message-only", "--yes"],
        capture_output=True,
        text=True,
        check=False,
    )
    return result.stdout.strip()


message = get_commit_message()
print(f"Generated message: {message}")
```

**スクリプト用途における主な特徴:**

- Rich による装飾やスピナーのないクリーンな出力
- 確認プロンプトを自動的にスキップ
- 実際の git コミットは行われない
- 単純な出力が必要な場合は `--one-liner` と組み合わせて使用可能
- `--hint` や `--model` などの他のフラグとも組み合わせて利用可能

### Pre-commit と Lefthook フックのスキップ

`--no-verify` フラグにより、プロジェクトで設定された pre-commit または lefthook フックをスキップできます：

```sh
gac --no-verify  # すべてのpre-commitとlefthookフックをスキップ
```

**`--no-verify` を使用する状況:**

- Pre-commit または lefthook フックが一時的に失敗している場合
- 時間のかかるフックを処理している場合
- まだすべてのチェックを通過していない作業中のコードをコミットする場合

**注意:** これらのフックはコード品質基準を維持するものであるため、注意して使用してください。

### セキュリティスキャン

gac には組み込みセキュリティスキャンが含まれており、コミット前にステージされた変更で潜在的な秘密と API キーを自動的に検出します。これにより、機密情報の偶然のコミットを防ぎます。

**セキュリティスキャンのスキップ:**

```sh
gac --skip-secret-scan  # このコミットのセキュリティスキャンをスキップ
```

**永続的に無効化するには:** `.gac.env` ファイルで `GAC_SKIP_SECRET_SCAN=true` を設定します。

**スキップする状況:**

- プレースホルダーキー付きのサンプルコードをコミットする場合
- ダミーの認証情報を含むテストフィクスチャを扱っている場合
- 変更が安全であることを確認した場合

**注意:** スキャナーはパターンマッチングを使用して一般的な秘密形式を検出します。コミット前に常に確認してください。

### SSL証明書検証

`--no-verify-ssl` フラグにより、API呼び出しのSSL証明書検証をスキップできます：

```sh
gac --no-verify-ssl  # このコミットのSSL検証をスキップ
```

**永続的に設定するには:** `.gac.env` ファイルで `GAC_NO_VERIFY_SSL=true` を設定します。

**`--no-verify-ssl` を使用する状況:**

- 企業プロキシがSSLトラフィックを傍受している場合（MITMプロキシ）
- 開発環境が自己署名証明書を使用している場合
- ネットワークセキュリティ設定によりSSL証明書エラーが発生する場合

**注意:** 信頼できるネットワーク環境でのみこのオプションを使用してください。SSL検証を無効にするとセキュリティが低下し、API要求が中間者攻撃に対して脆弱になる可能性があります。

## 設定に関する注意

- gac を設定する推奨方法は `gac init` を実行して対話的なプロンプトに従うことです。
- すでに言語を設定しており、プロバイダーやモデルを切り替える必要があるだけですか？`gac model` を実行して質問なしでセットアップを繰り返してください。
- **Claude Code を使用していますか？** OAuth 認証の手順については[Claude Code 設定ガイド](CLAUDE_CODE.md)を参照してください。
- **Qwen.aiを使用していますか？** [Qwen.ai設定ガイド](QWEN.md)でOAuth認証の手順を確認してください。
- gac は以下の優先度順で設定を読み込みます：
  1. CLI フラグ
  2. 環境変数
  3. プロジェクトレベル `.gac.env`
  4. ユーザーレベル `~/.gac.env`

### 高度な設定オプション

これらのオプションの環境変数で gac の動作をカスタマイズできます：

- `GAC_ALWAYS_INCLUDE_SCOPE=true` - コミットメッセージにスコープを自動的に推論して含める（例: `feat(auth):` vs `feat:`）
- `GAC_VERBOSE=true` - 動機、アーキテクチャ、影響セクションを含む詳細なコミットメッセージを生成
- `GAC_TEMPERATURE=0.7` - LLM の創造性を制御（0.0-1.0、低いほど focused）
- `GAC_MAX_OUTPUT_TOKENS=4096` - 生成されたメッセージの最大トークン数（`--group` 使用時にファイル数に基づいて自動的に 2-5 倍にスケーリング；これ以上または以下にするには上書き）
- `GAC_WARNING_LIMIT_TOKENS=4096` - プロンプトがこのトークン数を超えた場合に警告
- `GAC_SYSTEM_PROMPT_PATH=/path/to/custom_prompt.txt` - コミットメッセージ生成にカスタムシステムプロンプトを使用
- `GAC_LANGUAGE=Spanish` - 特定の言語でコミットメッセージを生成（例: Spanish, French, Japanese, German）。完全な名前または ISO コードをサポート（es, fr, ja, de, zh-CN）。対話的な選択には `gac language` を使用
- `GAC_TRANSLATE_PREFIXES=true` - 従来のコミットプレフィックス（feat, fix など）を対象言語に翻訳（デフォルト: false、プレフィックスは英語のまま）
- `GAC_SKIP_SECRET_SCAN=true` - ステージされた変更での秘密の自動セキュリティスキャンを無効化（注意して使用）
- `GAC_NO_VERIFY_SSL=true` - API呼び出しのSSL証明書検証をスキップ（SSLトラフィックを傍受する企業プロキシに便利）
- `GAC_NO_TIKTOKEN=true` - `tiktoken`ダウンロードステップをバイパスし、組み込みの大まかなトークン推定器を使用して完全にオフラインで維持

完全な設定テンプレートについては `.gac.env.example` を参照。

カスタムシステムプロンプト作成の詳細なガイドについては [CUSTOM_SYSTEM_PROMPTS.md](CUSTOM_SYSTEM_PROMPTS.md) を参照。

### 設定サブコマンド

以下のサブコマンドが利用可能です：

- `gac init` — プロバイダー、モデル、言語設定の対話的なセットアップウィザード
- `gac model` — 言語プロンプトなしのプロバイダー/モデル/API キー設定（クイックスイッチに最適）
- `gac auth` — すべてのプロバイダーのOAuth認証ステータスを表示
- `gac auth claude-code login` — OAuthを使用してClaude Codeにログイン（ブラウザを開く）
- `gac auth claude-code logout` — Claude Codeからログアウトして保存されたトークンを削除
- `gac auth claude-code status` — Claude Code認証ステータスを確認
- `gac auth qwen login` — OAuthデバイスフローを使用してQwenにログイン（ブラウザを開く）
- `gac auth qwen logout` — Qwenからログアウトして保存されたトークンを削除
- `gac auth qwen status` — Qwen認証ステータスを確認
- `gac config show` — 現在の設定を表示
- `gac config set KEY VALUE` — `$HOME/.gac.env` で設定キーを設定
- `gac config get KEY` — 設定値を取得
- `gac config unset KEY` — `$HOME/.gac.env` から設定キーを削除
- `gac language` (または `gac lang`) — コミットメッセージの対話的言語セレクター（GAC_LANGUAGE を設定）
- `gac diff` — ステージ/未ステージ変更、色、トランケーションのオプション付きでフィルタリングされた git diff を表示

## インタラクティブモード

`--interactive` (`-i`) フラグは、変更について的を絞った質問をすることで gac のコミットメッセージ生成を向上させます。この追加のコンテキストは、LLM がより正確で詳細で文脈に適したコミットメッセージを作成するのに役立ちます。

### 動作方法

`--interactive` を使用すると、gac はこのような質問をします：

- **これらの変更の主な目的は何ですか？** - 高レベルの目標を理解するのに役立ちます
- **どの問題を解決していますか？** - 動機に関するコンテキストを提供します
- **言及する価値のある実装詳細はありますか？** - 技術的な仕様をキャプチャします
- **破壊的変更はありますか？** - 潜在的な影響の問題を特定します
- **これは issue やチケットに関連していますか？** - プロジェクト管理にリンクします

### インタラクティブモードを使用する場合

インタラクティブモードは特に以下の場合に便利です：

- **複雑な変更** - diff だけではコンテキストが明確でない場合
- **リファクタリング作業** - 複数のファイルと概念にまたがる場合
- **新機能** - 全体的な目的の説明が必要な場合
- **バグ修正** - 根本的な原因がすぐに見えない場合
- **パフォーマンス最適化** - 理由が明確でない場合
- **コードレビュー準備** - 質問が変更について考えるのに役立ちます

### 使用例

**基本的なインタラクティブモード:**

```sh
gac -i
```

これにより以下が行われます：

1. ステージされた変更の要約を表示します
2. 変更について質問します
3. 回答を含めてコミットメッセージを生成します
4. 確認を求めます（または `-y` と組み合わせた場合は自動確認）

**ステージされた変更でインタラクティブモード:**

```sh
gac -ai
# すべての変更をステージしてから、より良いコンテキストのために質問します
```

**特定のヒントでインタラクティブモード:**

```sh
gac -i -h "ユーザープロファイルのデータベース移行"
# LLM を集中させるための特定のヒントを提供しながら質問します
```

**詳細出力でインタラクティブモード:**

```sh
gac -i -v
# 質問して詳細で構造化されたコミットメッセージを生成します
```

**自動確認インタラクティブモード:**

```sh
gac -i -y
# 質問しますが、結果のコミットを自動確認します
```

### 質疑応答ワークフロー

インタラクティブワークフローはこのパターンに従います：

1. **変更の確認** - gac がコミットしている内容の要約を表示します
2. **質問に回答** - 各プロンプトに関連する詳細で回答します
3. **コンテキストの向上** - 回答が LLM プロンプトに追加されます
4. **メッセージ生成** - LLM が完全なコンテキストでコミットメッセージを作成します
5. **確認** - コミットを確認して確認します（または `-y` で自動確認）

**有用な回答を提供するためのヒント：**

- **簡潔だが徹底的に** - 過度に冗長にならずに重要な詳細を提供します
- **「なぜ」に焦点を当てる** - 変更の背後にある理由を説明します
- **制約に言及** - 制限や特別な考慮事項に注意します
- **外部コンテキストにリンク** - issue、ドキュメント、設計ドキュメントを参照します
- **空の回答も可** - 質問が適用されない場合は、Enter キーを押すだけです

### 他のフラグとの組み合わせ

インタラクティブモードは他のほとんどのフラグと良好に動作します：

```sh
# すべての変更をステージして質問します
gac -ai

# 詳細出力で質問します
gac -i -v
```

### ベストプラクティス

- **複雑な PR で使用** - 詳細な説明が必要な pull request で特に便利です
- **チームコラボレーション** - 質問は他の人がレビューする変更について考えるのに役立ちます
- **ドキュメント準備** - 回答はリリースノートの基礎を形成するのに役立ちます
- **学習ツール** - 質問はコミットメッセージの良いプラクティスを強化します
- **簡単な変更ではスキップ** - 自明な修正の場合、基本モードの方が高速です

## ヘルプ

- カスタムシステムプロンプトについては [CUSTOM_SYSTEM_PROMPTS.md](CUSTOM_SYSTEM_PROMPTS.md) を参照
- トラブルシューティングと高度なヒントについては [TROUBLESHOOTING.md](TROUBLESHOOTING.md) を参照
- インストールと設定については [../README.md](../README.md) を参照
- 貢献については [CONTRIBUTING.md](CONTRIBUTING.md) を参照
- ライセンス情報: [../LICENSE](../LICENSE)
