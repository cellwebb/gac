# カスタムシステムプロンプト

[English](../en/CUSTOM_SYSTEM_PROMPTS.md) | [简体中文](../zh-CN/CUSTOM_SYSTEM_PROMPTS.md) | [繁體中文](../zh-TW/CUSTOM_SYSTEM_PROMPTS.md) | **日本語** | [한국어](../ko/CUSTOM_SYSTEM_PROMPTS.md) | [हिन्दी](../hi/CUSTOM_SYSTEM_PROMPTS.md) | [Tiếng Việt](../vi/CUSTOM_SYSTEM_PROMPTS.md) | [Français](../fr/CUSTOM_SYSTEM_PROMPTS.md) | [Русский](../ru/CUSTOM_SYSTEM_PROMPTS.md) | [Español](../es/CUSTOM_SYSTEM_PROMPTS.md) | [Português](../pt/CUSTOM_SYSTEM_PROMPTS.md) | [Norsk](../no/CUSTOM_SYSTEM_PROMPTS.md) | [Svenska](../sv/CUSTOM_SYSTEM_PROMPTS.md) | [Deutsch](../de/CUSTOM_SYSTEM_PROMPTS.md) | [Nederlands](../nl/CUSTOM_SYSTEM_PROMPTS.md) | [Italiano](../it/CUSTOM_SYSTEM_PROMPTS.md)

このガイドでは、GACがコミットメッセージの生成に使用するシステムプロンプトをカスタマイズする方法について説明し、独自のコミットメッセージスタイルと規約を定義できるようにします。

## 目次

- [カスタムシステムプロンプト](#カスタムシステムプロンプト)
  - [目次](#目次)
  - [システムプロンプトとは？](#システムプロンプトとは)
  - [カスタムシステムプロンプトを使用する理由](#カスタムシステムプロンプトを使用する理由)
  - [クイックスタート](#クイックスタート)
  - [カスタムシステムプロンプトの作成](#カスタムシステムプロンプトの作成)
  - [例](#例)
    - [絵文字ベースのコミットスタイル](#絵文字ベースのコミットスタイル)
    - [チーム固有の規約](#チーム固有の規約)
    - [詳細な技術スタイル](#詳細な技術スタイル)
  - [ベストプラクティス](#ベストプラクティス)
    - [推奨:](#推奨)
    - [非推奨:](#非推奨)
    - [ヒント:](#ヒント)
  - [トラブルシューティング](#トラブルシューティング)
    - [メッセージがまだ "chore:" プレフィックスを持っている](#メッセージがまだ-chore-プレフィックスを持っている)
    - [AIが指示を無視している](#aiが指示を無視している)
    - [メッセージが長すぎる/短すぎる](#メッセージが長すぎる短すぎる)
    - [カスタムプロンプトが使用されていない](#カスタムプロンプトが使用されていない)
    - [デフォルトに戻したい](#デフォルトに戻したい)
  - [関連ドキュメント](#関連ドキュメント)
  - [ヘルプが必要ですか？](#ヘルプが必要ですか)

## システムプロンプトとは？

GACはコミットメッセージを生成する際に2つのプロンプトを使用します：

1. **システムプロンプト**（カスタマイズ可能）: 役割、スタイル、コミットメッセージの規約を定義する指示
2. **ユーザープロンプト**（自動）: 何が変更されたかを示すgit diffデータ

システムプロンプトはAIにコミットメッセージを*どのように*書くかを伝え、ユーザープロンプトは*何*を（実際のコード変更）提供します。

## カスタムシステムプロンプトを使用する理由

カスタムシステムプロンプトが必要な場合：

- チームが従来のコミットとは異なるコミットメッセージスタイルを使用している場合
- 絵文字、プレフィックス、または他のカスタム形式を好む場合
- コミットメッセージでより多く/少ない詳細が必要な場合
- 会社固有のガイドラインやテンプレートがある場合
- チームの声とトーンに一致させたい場合
- 異なる言語でコミットメッセージが必要な場合（以下の言語設定を参照）

## クイックスタート

1. **カスタムシステムプロンプトファイルを作成:**

   ```bash
   # 例をコピーして開始点として使用
   cp custom_system_prompt.example.txt ~/.config/gac/my_system_prompt.txt

   # またはスクラッチで作成
   vim ~/.config/gac/my_system_prompt.txt
   ```

2. **`.gac.env` ファイルに追加:**

   ```bash
   # ~/.gac.env またはプロジェクトレベル .gac.env で
   GAC_SYSTEM_PROMPT_PATH=/path/to/your/custom_system_prompt.txt
   ```

3. **テストする:**

   ```bash
   gac --dry-run
   ```

これだけです！GACはデフォルトの代わりにカスタム指示を使用するようになります。

## カスタムシステムプロンプトの作成

カスタムシステムプロンプトはプレーンテキストでよい - 特別な形式やXMLタグは必要ありません。AIがコミットメッセージを生成すべき方法の明確な指示を書いてください。

**含めるべき重要な点:**

1. **役割定義** - AIがどのように振る舞うべきか
2. **形式要件** - 構造、長さ、スタイル
3. **例** - 良いコミットメッセージがどのように見えるかを示す
4. **制約** - 避けること、または満たすべき要件

**例の構造:**

```text
[あなたのプロジェクト/チーム用]のコミットメッセージライターです。

コード変更を分析する際、以下のコミットメッセージを作成してください：

1. [最初の要件]
2. [2番目の要件]
3. [3番目の要件]

形式の例:
[コミットメッセージの例を表示]

あなたの応答全体がコミットメッセージとして直接使用されます。
```

## 例

### 絵文字ベースのコミットスタイル

完全な絵文字ベースの例については [`custom_system_prompt.example.txt`](../../examples/custom_system_prompt.example.txt) を参照。

**簡単なスニペット:**

```text
絵文字とフレンドリーなトーンを使用するコミットメッセージライターです。

各メッセージを絵文字で開始：
- 🎉 新機能用
- 🐛 バグ修正用
- 📝 ドキュメント用
- ♻️ リファクタリング用

最初の行を72文字以内に保ち、なぜ変更が重要かを説明してください。
```

### チーム固有の規約

```text
エンタープライズ銀行アプリケーションのコミットメッセージを作成しています。

要件:
1. JIRAチケット番号を角括弧で開始（例: [BANK-1234]）
2. 正式でプロフェッショナルなトーンを使用
3. 関連性がある場合はセキュリティへの影響を含める
4. コンプライアンス要件を参照（PCI-DSS、SOC2など）
5. メッセージを簡潔だが完全に保つ

形式:
[TICKET-123] 変更の簡単な要約

何が変更され、なぜかの詳細な説明。以下を含める:
- ビジネス上の正当性
- 技術的アプローチ
- リスク評価（該用する場合）

例:
[BANK-1234] ログインエンドポイントのレート制限を実装

ブルートフォース攻撃を防ぐためにRedisベースのレート制限を追加。
IPあたり15分あたり5回のログイン試行に制限。
SOC2セキュリティ要件のアクセス制御に準拠。
```

### 詳細な技術スタイル

```text
包括的なドキュメントを作成する技術的なコミットメッセージライターです。

各コミットについて、以下を提供してください：

1. 明確で説明的なタイトル（72文字以内）
2. 空行
3. WHAT: 何が変更されたか（2-3文）
4. WHY: なぜ変更が必要だったか（2-3文）
5. HOW: 技術的アプローチまたは主要な実装の詳細
6. IMPACT: 影響を受けるファイル/コンポーネントと影響の可能性

技術的な正確性を使用。特定の関数、クラス、モジュールを参照。
現在時制と能動態を使用。

例:
依存性注入を使用して認証ミドルウェアをリファクタリング

WHAT: グローバル認証状態を注入可能なAuthServiceに置き換え。
すべてのルートハンドラーを更新してコンストラクター注入でAuthServiceを受け入れるように。

WHY: グローバル状態はテストを困難にし、隠れた依存関係を作成。
依存性注入はテスト容易性を向上し、依存関係を明示的にする。

HOW: AuthServiceインターフェースを作成、JWTAuthServiceと
MockAuthServiceを実装。依存性注入コンテナ設定を更新して
ルートハンドラーコンストラクターを変更。

IMPACT: 認証されたすべてのルートに影響。
ユーザーの動作変更はなし。MockAuthServiceでテストが3倍高速に。
routes/auth.ts、routes/api.ts、routes/admin.tsの移行が必要。
```

## ベストプラクティス

### 推奨

- ✅ **具体的である** - 明確な指示がより良い結果を生む
- ✅ **例を含める** - AIに良い見た目を見せる
- ✅ **反復的にテストする** - プロンプトを試し、結果に基づいて洗練させる
- ✅ **焦点を絞る** - 多くのルールがAIを混乱させる可能性がある
- ✅ **一貫した用語を使用** - 全体を通じて同じ用語を貫く
- ✅ **リマインダーで終了** - 応答がそのまま使用されることを強化

### 非推奨

- ❌ **XMLタグを使用** - プレーンテキストが最適（その構造を特に望まない限り）
- ❌ **長すぎる** - 200-500語の指示を目指す
- ❌ **矛盾する** - 要件で一貫性を保つ
- ❌ **終了を忘れる** - 常に「あなたの応答全体がコミットメッセージとして直接使用されます」と終了

### ヒント

- **例から開始** - `../../examples/custom_system_prompt.example.txt` をコピーして修正
- **`--dry-run`でテスト** - コミットなしで結果を確認
- **`--show-prompt`を使用** - AIに送信されているものを確認
- **結果に基づいて反復** - メッセージが適切でなければ指示を調整
- **プロンプトをバージョン管理** - カスタムプロンプトをチームのリポジトリに保持
- **プロジェクト固有のプロンプト** - プロジェクトレベル `.gac.env` をプロジェクト固有のスタイルに使用

## トラブルシューティング

### メッセージがまだ "chore:" プレフィックスを持っている

**問題:** カスタム絵文字メッセージに "chore:" が追加されている。

**解決策:** これは起こるべきではありません - GACはカスタムシステムプロンプト使用時に従来のコミット強制を自動的に無効にします。これを確認した場合、[issueを提出](https://github.com/cellwebb/gac/issues)してください。

### AIが指示を無視している

**問題:** 生成されたメッセージがカcustomize形式に従っていない。

**解決策:**

1. 指示をより明確で具体的にする
2. 望ましい形式の明確な例を追加
3. 「あなたの応答全体がコミットメッセージとして直接使用されます」と終了
4. 要件の数を減らす - 多すぎるとAIを混乱させる可能性がある
5. 異なるモデルを試す（指示に従うのが良い/悪いモデルがある）

### メッセージが長すぎる/短すぎる

**問題:** 生成されたメッセージが長さ要件を満たしていない。

**解決策:**

- 長さを明確にする（例: 「メッセージを50文字以内に保つ」）
- 望ましい正確な長さの例を表示
- 短いメッセージ用に `--one-liner` フラグも使用を検討

### カスタムプロンプトが使用されていない

**問題:** GACがまだデフォルトのコミット形式を使用している。

**解決策:**

1. `GAC_SYSTEM_PROMPT_PATH` が正しく設定されていることを確認:

   ```bash
   gac config get GAC_SYSTEM_PROMPT_PATH
   ```

2. ファイルパスが存在して読み取り可能であることを確認:

   ```bash
   cat "$GAC_SYSTEM_PROMPT_PATH"
   ```

3. この順序で `.gac.env` ファイルをチェック:
   - プロジェクトレベル: `./.gac.env`
   - ユーザーレベル: `~/.gac.env`
4. 相対パスの代わりに絶対パスを試す

### 言語設定

**注意:** コミットメッセージの言語を変更するだけではカスタムシステムプロンプトは必要ありません！

コミットメッセージの言語だけを変更（標準の従来のコミット形式は維持）したい場合、対話的言語セレクターを使用します：

```bash
gac language
```

これにより、ネイティブスクリプト（Español、Français、日本語など）の25以上の言語の対話的メニューが表示されます。希望の言語を選択すると、自動的に `~/.gac.env` ファイルで `GAC_LANGUAGE` が設定されます。

または、手動で言語を設定：

```bash
# ~/.gac.env またはプロジェクトレベル .gac.env で
GAC_LANGUAGE=Japanese
```

デフォルトでは、従来のコミットプレフィックス（feat:, fix:など）はchangelogツールとCI/CDパイプラインとの互換性のために英語のままですが、他のすべてのテキストは指定した言語になります。

**プレフィックスも翻訳したいですか？** `.gac.env` で `GAC_TRANSLATE_PREFIXES=true` を設定して完全なローカライズを：

```bash
GAC_LANGUAGE=Japanese
GAC_TRANSLATE_PREFIXES=true
```

これにより、プレフィックスを含むすべてが翻訳されます（例: `fix:` の代わりに `修正:`）。

言語だけのカスタマイズニーズの場合、これはカスタムシステムプロンプトを作成するよりも簡単です。

### デフォルトに戻したい

**問題:** 一時的にデフォルトプロンプトを使用したい。

**解決策:**

```bash
# オプション1: 環境変数を設定解除
gac config unset GAC_SYSTEM_PROMPT_PATH

# オプション2: .gac.env でコメントアウト
# GAC_SYSTEM_PROMPT_PATH=/path/to/custom_prompt.txt

# オプション3: 特定のプロジェクトに別の .gac.env を使用
```

---

## 関連ドキュメント

- [USAGE.md](../USAGE.md) - コマンドラインフラグとオプション
- [README.md](../README.md) - インストールと基本セットアップ
- [TROUBLESHOOTING.md](../TROUBLESHOOTING.md) - 一般的なトラブルシューティング

## ヘルプが必要ですか？

- 問題を報告: [GitHub Issues](https://github.com/cellwebb/gac/issues)
- カスタムプロンプトを共有: 貢献を歓迎します！
