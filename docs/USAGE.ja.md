# gac コマンドライン使用法

English | [简体中文](USAGE.zh-CN.md) | [繁體中文](USAGE.zh-TW.md) | **日本語**

このドキュメントでは、`gac` CLIツールで利用可能なすべてのフラグとオプションについて説明します。

## 目次

- [gac コマンドライン使用法](#gac-コマンドライン使用法)
  - [目次](#目次)
  - [基本使用法](#基本使用法)
  - [コアワークフローフラグ](#コアワークフローフラグ)
  - [メッセージカスタマイズ](#メッセージカスタマイズ)
  - [出力と詳細レベル](#出力と詳細レベル)
  - [ヘルプとバージョン](#ヘルプとバージョン)
  - [ワークフロー例](#ワークフロー例)
  - [詳細](#詳細)
    - [Pre-commitとLefthookフックのスキップ](#pre-commitとlefthookフックのスキップ)
  - [設定に関する注意](#設定に関する注意)
    - [高度な設定オプション](#高度な設定オプション)
    - [設定サブコマンド](#設定サブコマンド)
  - [ヘルプ](#ヘルプ)

## 基本使用法

```sh
gac init
# 次にプロンプトに従ってプロバイダー、モデル、APIキーを対話的に設定
gac
```

ステージされた変更に対してLLMを活用したコミットメッセージを生成し、確認を求めます。確認プロンプトでは以下が受け付けられます：

- `y` または `yes` - コミットを続行
- `n` または `no` - コミットをキャンセル
- `r` または `reroll` - 同じコンテキストでコミットメッセージを再生成
- `e` または `edit` - リッチなターミナル編集でコミットメッセージをその場編集（vi/emacsキーバインド）
- その他のテキスト - そのテキストをフィードバックとして再生成（例: `もっと短くして`、`パフォーマンスに集中`）
- 空入力（Enterのみ） - プロンプトを再表示

---

## コアワークフローフラグ

| フラグ / オプション  | 短い形式 | 説明                                                   |
| -------------------- | -------- | ------------------------------------------------------ |
| `--add-all`          | `-a`     | コミット前にすべての変更をステージ                     |
| `--group`            | `-g`     | ステージされた変更を複数の論理的なコミットにグループ化 |
| `--push`             | `-p`     | コミット後にリモートにプッシュ                         |
| `--yes`              | `-y`     | プロンプトなしで自動的にコミットを確定                 |
| `--dry-run`          |          | 変更なしで何が起こるかを表示                           |
| `--no-verify`        |          | コミット時にpre-commitとlefthookフックをスキップ       |
| `--skip-secret-scan` |          | ステージされた変更での秘密検出をスキップ               |

**注意:** `-ag` のように `-a` と `-g` を組み合わせて、まずすべての変更をステージしてからコミットにグループ化します。

**注意:** `--group` を使用する場合、最大出力トークン制限はコミットされるファイル数に基づいて自動的にスケーリングされます（ファイル数1-9で2倍、10-19で3倍、20-29で4倍、30以上で5倍）。これにより、LLMが大きな変更セットでもトランケーションなしですべてのグループ化されたコミットを生成するのに十分なトークンを確保できます。

## メッセージカスタマイズ

| フラグ / オプション | 短い形式 | 説明                                                             |
| ------------------- | -------- | ---------------------------------------------------------------- |
| `--one-liner`       | `-o`     | 単一行のコミットメッセージを生成                                 |
| `--verbose`         | `-v`     | 動機、アーキテクチャ、影響を含む詳細なコミットメッセージを生成   |
| `--hint <text>`     | `-h`     | LLMを導くヒントを追加                                            |
| `--model <model>`   | `-m`     | このコミットで使用するモデルを指定                               |
| `--language <lang>` | `-l`     | 言語を上書き（名前またはコード: 'Spanish', 'es', 'zh-CN', 'ja'） |
| `--scope`           | `-s`     | コミットの適切なスコープを推論                                   |

**注意:** 確認プロンプトで直接フィードバックを入力することで対話的にフィードバックを提供できます - 'r' を前置する必要はありません。シンプルな再生成には `r`、vi/emacsキーバインドでその場編集には `e`、または直接フィードバックを入力（例: `もっと短くして`）。

## 出力と詳細レベル

| フラグ / オプション   | 短い形式 | 説明                                                  |
| --------------------- | -------- | ----------------------------------------------------- |
| `--quiet`             | `-q`     | エラー以外のすべての出力を抑制                        |
| `--log-level <level>` |          | ログレベルを設定（debug, info, warning, error）       |
| `--show-prompt`       |          | コミットメッセージ生成に使用されるLLMプロンプトを表示 |

## ヘルプとバージョン

| フラグ / オプション | 短い形式 | 説明                           |
| ------------------- | -------- | ------------------------------ |
| `--version`         |          | gacバージョンを表示して終了    |
| `--help`            |          | ヘルプメッセージを表示して終了 |

---

## ワークフロー例

- **すべての変更をステージしてコミット:**

  ```sh
  gac -a
  ```

- **ワンステップでコミットしてプッシュ:**

  ```sh
  gac -ap
  ```

- **単一行コミットメッセージを生成:**

  ```sh
  gac -o
  ```

- **構造化セクション付きの詳細なコミットメッセージを生成:**

  ```sh
  gac -v
  ```

- **LLMにヒントを追加:**

  ```sh
  gac -h "認証ロジックをリファクタリング"
  ```

- **コミットのスコープを推論:**

  ```sh
  gac -s
  ```

- **ステージされた変更を論理的なコミットにグループ化:**

  ```sh
  gac -g
  # すでにステージしたファイルのみをグループ化
  ```

- **すべての変更（ステージ＋未ステージ）をグループ化して自動確定:**

  ```sh
  gac -agy
  # すべてをステージ、グループ化、自動確定
  ```

- **このコミットのみ特定のモデルを使用:**

  ```sh
  gac -m anthropic:claude-3-5-haiku-latest
  ```

- **特定の言語でコミットメッセージを生成:**

  ```sh
  # 言語コードを使用（短い）
  gac -l zh-CN
  gac -l ja
  gac -l es

  # 完全な名前を使用
  gac -l "Simplified Chinese"
  gac -l Japanese
  gac -l Spanish
  ```

- **ドライラン（何が起こるかを確認）:**

  ```sh
  gac --dry-run
  ```

## 詳細

- より強力なワークフローのためにフラグを組み合わせる（例: `gac -ayp` でステージ、自動確定、プッシュ）
- `--show-prompt` を使用してLLMに送信されるプロンプトをデバッグ・確認
- `--log-level` または `--quiet` で詳細レベルを調整

### Pre-commitとLefthookフックのスキップ

`--no-verify` フラグにより、プロジェクトで設定されたpre-commitまたはlefthookフックをスキップできます：

```sh
gac --no-verify  # すべてのpre-commitとlefthookフックをスキップ
```

**`--no-verify` を使用する状況:**

- Pre-commitまたはlefthookフックが一時的に失敗している場合
- 時間のかかるフックを処理している場合
- まだすべてのチェックを通過していない作業中のコードをコミットする場合

**注意:** これらのフックはコード品質基準を維持するものであるため、注意して使用してください。

### セキュリティスキャン

gacには組み込みセキュリティスキャンが含まれており、コミット前にステージされた変更で潜在的な秘密とAPIキーを自動的に検出します。これにより、機密情報の偶然のコミットを防ぎます。

**セキュリティスキャンのスキップ:**

```sh
gac --skip-secret-scan  # このコミットのセキュリティスキャンをスキップ
```

**永続的に無効化するには:** `.gac.env` ファイルで `GAC_SKIP_SECRET_SCAN=true` を設定します。

**スキップする状況:**

- プレースホルダーキー付きのサンプルコードをコミットする場合
- ダミーの認証情報を含むテストフィクスチャを扱っている場合
- 変更が安全であることを確認した場合

**注意:** スキャナーはパターンマッチングを使用して一般的な秘密形式を検出します。コミット前に常ステージされた変更を確認してください。

## 設定に関する注意

- gacを設定する推奨方法は `gac init` を実行して対話的なプロンプトに従うことです。
- すでに言語を設定しており、プロバイダーやモデルを切り替える必要があるだけですか？`gac model` を実行して質問なしでセットアップを繰り返してください。
- gacは以下の優先度順で設定を読み込みます：
  1. CLIフラグ
  2. 環境変数
  3. プロジェクトレベル `.gac.env`
  4. ユーザーレベル `~/.gac.env`

### 高度な設定オプション

これらのオプションの環境変数でgacの動作をカスタマイズできます：

- `GAC_ALWAYS_INCLUDE_SCOPE=true` - コミットメッセージにスコープを自動的に推論して含める（例: `feat(auth):` vs `feat:`）
- `GAC_VERBOSE=true` - 動機、アーキテクチャ、影響セクションを含む詳細なコミットメッセージを生成
- `GAC_TEMPERATURE=0.7` - LLMの創造性を制御（0.0-1.0、低いほど focused）
- `GAC_MAX_OUTPUT_TOKENS=4096` - 生成されたメッセージの最大トークン数（`--group` 使用時にファイル数に基づいて自動的に2-5倍にスケーリング；これ以上または以下にするには上書き）
- `GAC_WARNING_LIMIT_TOKENS=4096` - プロンプトがこのトークン数を超えた場合に警告
- `GAC_SYSTEM_PROMPT_PATH=/path/to/custom_prompt.txt` - コミットメッセージ生成にカスタムシステムプロンプトを使用
- `GAC_LANGUAGE=Spanish` - 特定の言語でコミットメッセージを生成（例: Spanish, French, Japanese, German）。完全な名前またはISOコードをサポート（es, fr, ja, de, zh-CN）。対話的な選択には `gac language` を使用
- `GAC_TRANSLATE_PREFIXES=true` - 従来のコミットプレフィックス（feat, fixなど）を対象言語に翻訳（デフォルト: false、プレフィックスは英語のまま）
- `GAC_SKIP_SECRET_SCAN=true` - ステージされた変更での秘密の自動セキュリティスキャンを無効化（注意して使用）

完全な設定テンプレートについては `.gac.env.example` を参照。

カスタムシステムプロンプト作成の詳細なガイドについては [docs/CUSTOM_SYSTEM_PROMPTS.ja.md](docs/CUSTOM_SYSTEM_PROMPTS.ja.md) を参照。

### 設定サブコマンド

以下のサブコマンドが利用可能です：

- `gac init` — プロバイダー、モデル、言語設定の対話的なセットアップウィザード
- `gac model` — 言語プロンプトなしのプロバイダー/モデル/APIキーセットアップ（クイックスイッチに最適）
- `gac config show` — 現在の設定を表示
- `gac config set KEY VALUE` — `$HOME/.gac.env` に設定キーを設定
- `gac config get KEY` — 設定値を取得
- `gac config unset KEY` — `$HOME/.gac.env` から設定キーを削除
- `gac language` (または `gac lang`) — コミットメッセージの対話的言語セレクター（GAC_LANGUAGEを設定）
- `gac diff` — ステージ/未ステージ変更、色、トランケーションのオプション付きでフィルタリングされたgit diffを表示

## ヘルプ

- カスタムシステムプロンプトについては [docs/CUSTOM_SYSTEM_PROMPTS.ja.md](docs/CUSTOM_SYSTEM_PROMPTS.ja.md) を参照
- トラブルシューティングと高度なヒントについては [docs/TROUBLESHOOTING.ja.md](docs/TROUBLESHOOTING.ja.md) を参照
- インストールと設定については [README.md#installation-and-configuration](README.md#installation-and-configuration) を参照
- 貢献については [docs/CONTRIBUTING.ja.md](docs/CONTRIBUTING.ja.md) を参照
- ライセンス情報: [LICENSE](LICENSE)
